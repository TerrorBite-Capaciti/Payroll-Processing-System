000100 IDENTIFICATION DIVISION.
000200 PROGRAM-ID. PAYROLL.
000300 AUTHOR.     YOUR-NAME.
000400 DATE-WRITTEN. TODAY.
000500
000600 ENVIRONMENT DIVISION.
000700 CONFIGURATION SECTION.
000800 SOURCE-COMPUTER. IBM-370.
000900 OBJECT-COMPUTER. IBM-370.
001000
001100 INPUT-OUTPUT SECTION.
001200 FILE-CONTROL.
001300     SELECT EMPLOYEE-FILE ASSIGN TO 'EMPFILE'
001400         ORGANIZATION IS INDEXED
001500         ACCESS MODE IS DYNAMIC
001600         RECORD KEY IS EMP-ID
001700         FILE STATUS IS EMP-FILE-STATUS.
001800
001900     SELECT PAYROLL-TRANS-FILE ASSIGN TO 'PAYTRAN'
002000         ORGANIZATION IS SEQUENTIAL
002100         FILE STATUS IS PAY-TRANS-STATUS.
002200
002300     SELECT PAYSLIP-FILE ASSIGN TO 'PAYSLIP'
002400         ORGANIZATION IS SEQUENTIAL
002500         FILE STATUS IS PAYSLIP-STATUS.
002600
002700 DATA DIVISION.
002800 FILE SECTION.
002900 FD  EMPLOYEE-FILE.
003000 01  EMPLOYEE-RECORD.
003100     05  EMP-ID                PIC X(06).
003200     05  EMP-NAME              PIC X(40).
003300     05  EMP-DEPT              PIC X(15).
003400     05  EMP-POSITION          PIC X(20).
003500     05  EMP-BASE-SALARY       PIC 9(07)V99.
003600     05  EMP-TAX-CODE          PIC X(02).
003700     05  EMP-MARITAL-STATUS    PIC X(01).
003800     05  EMP-NUM-DEPENDENTS    PIC 9(02).
003900     05  EMP-LEAVE-BALANCE     PIC S9(03).
004000     05  EMP-ACCOUNT-NUM       PIC X(20).
004100     05  FILLER                PIC X(20).
004200
004300 FD  PAYROLL-TRANS-FILE.
004400 01  PAYROLL-TRANS-RECORD.
004500     05  PT-EMP-ID            PIC X(06).
004600     05  PT-HOURS-WORKED      PIC 9(03)V99.
004700     05  PT-OVERTIME-HOURS    PIC 9(03)V99.
004800     05  PT-BONUS-AMOUNT      PIC 9(05)V99.
004900     05  PT-ALLOWANCES        PIC 9(05)V99.
005000     05  PT-UNPAID-LEAVE      PIC 9(02).
005100     05  PT-PERIOD-START      PIC 9(08).
005200     05  PT-PERIOD-END        PIC 9(08).
005300     05  FILLER               PIC X(20).
005400
005500 FD  PAYSLIP-FILE.
005600 01  PAYSLIP-RECORD.
005700     05  PS-EMP-ID            PIC X(06).
005800     05  PS-EMP-NAME          PIC X(40).
005900     05  PS-PERIOD            PIC X(17).
006000     05  PS-GROSS-PAY         PIC Z,ZZZ,ZZ9.99.
006100     05  PS-TAX-DEDUCTIONS    PIC Z,ZZZ,ZZ9.99.
006200     05  PS-OTHER-DEDUCTIONS  PIC Z,ZZZ,ZZ9.99.
006300     05  PS-NET-PAY           PIC Z,ZZZ,ZZ9.99.
006400     05  PS-PAYMENT-DATE      PIC X(10).
006500     05  FILLER               PIC X(20).
006600
006700 WORKING-STORAGE SECTION.
006800 01  FILE-STATUS-VARS.
006900     05  EMP-FILE-STATUS      PIC XX.
007000     05  PAY-TRANS-STATUS     PIC XX.
007100     05  PAYSLIP-STATUS       PIC XX.
007200
007300 01  PROGRAM-CONTROL.
007400     05  WS-END-OF-FILE       PIC X(01) VALUE 'N'.
007500         88  EOF              VALUE 'Y'.
007600         88  NOT-EOF          VALUE 'N'.
007700     05  WS-EMPLOYEE-FOUND    PIC X(01) VALUE 'N'.
007800         88  EMPLOYEE-FOUND   VALUE 'Y'.
007900         88  EMPLOYEE-NOT-FOUND VALUE 'N'.
008000
008100 01  WS-CALCULATION-VARS.
008200     05  WS-GROSS-PAY         PIC 9(07)V99.
008300     05  WS-TAX-AMOUNT        PIC 9(07)V99.
008400     05  WS-NET-PAY           PIC 9(07)V99.
008500     05  WS-OVERTIME-PAY      PIC 9(07)V99.
008600     05  WS-LEAVE-DEDUCTION   PIC 9(07)V99.
008700     05  WS-TOTAL-DEDUCTIONS  PIC 9(07)V99.
008800
008900 01  WS-CURRENT-DATE.
009000     05  WS-CURRENT-YEAR      PIC 9(04).
009100     05  WS-CURRENT-MONTH     PIC 9(02).
009200     05  WS-CURRENT-DAY       PIC 9(02).
009300
009400 PROCEDURE DIVISION.
009500 000-MAIN-PAYROLL-PROCESSING.
009600     PERFORM 100-INITIALIZE-PAYROLL.
009700     PERFORM 200-PROCESS-PAYROLL-TRANSACTIONS.
009800     PERFORM 300-TERMINATE-PAYROLL.
009900     GOBACK.
010000
010100 100-INITIALIZE-PAYROLL.
010200     MOVE FUNCTION CURRENT-DATE TO WS-CURRENT-DATE.
010300     OPEN INPUT EMPLOYEE-FILE
010400          PAYROLL-TRANS-FILE
010500          OUTPUT PAYSLIP-FILE.
010600
010700     IF EMP-FILE-STATUS NOT = '00'
010800         DISPLAY 'ERROR OPENING EMPLOYEE FILE: ' EMP-FILE-STATUS
010900         MOVE 'Y' TO WS-END-OF-FILE.
011000
011100     IF PAY-TRANS-STATUS NOT = '00'
011200         DISPLAY 'ERROR OPENING PAYROLL TRANS FILE: ' PAY-TRANS-STATUS
011300         MOVE 'Y' TO WS-END-OF-FILE.
011400
011500     IF PAYSLIP-STATUS NOT = '00'
011600         DISPLAY 'ERROR OPENING PAYSLIP FILE: ' PAYSLIP-STATUS
011700         MOVE 'Y' TO WS-END-OF-FILE.
011800
011900 200-PROCESS-PAYROLL-TRANSACTIONS.
012000     PERFORM UNTIL EOF
012100         READ PAYROLL-TRANS-FILE
012200             AT END
012300                 MOVE 'Y' TO WS-END-OF-FILE
012400             NOT AT END
012500                 IF PAY-TRANS-STATUS = '00'
012600                     PERFORM 210-PROCESS-EMPLOYEE-PAYROLL
012700                 ELSE
012800                     DISPLAY 'ERROR READING PAYROLL TRANS FILE: '
012900                             PAY-TRANS-STATUS
013000                 END-IF
013100         END-READ
013200     END-PERFORM.
013300
013400 210-PROCESS-EMPLOYEE-PAYROLL.
013500     MOVE PT-EMP-ID TO EMP-ID.
013600     READ EMPLOYEE-FILE
013700         INVALID KEY
013800             DISPLAY 'EMPLOYEE NOT FOUND: ' PT-EMP-ID
013900             MOVE 'N' TO WS-EMPLOYEE-FOUND
014000         NOT INVALID KEY
014100             MOVE 'Y' TO WS-EMPLOYEE-FOUND
014200             PERFORM 220-CALCULATE-GROSS-PAY
014300             PERFORM 230-CALCULATE-TAX-DEDUCTIONS
014400             PERFORM 231-CALCULATE-DEDUCTIONS
014500             PERFORM 240-GENERATE-PAYSLIP
014600     END-READ.
014700
014800 220-CALCULATE-GROSS-PAY.
014900     COMPUTE WS-GROSS-PAY = PT-HOURS-WORKED * (EMP-BASE-SALARY / 160).
015000     IF PT-OVERTIME-HOURS > 0
015100         COMPUTE WS-OVERTIME-PAY = PT-OVERTIME-HOURS * 
015200                                  (EMP-BASE-SALARY / 160) * 1.5
015300         ADD WS-OVERTIME-PAY TO WS-GROSS-PAY
015400     END-IF.
015500     ADD PT-BONUS-AMOUNT TO WS-GROSS-PAY.
015600     ADD PT-ALLOWANCES TO WS-GROSS-PAY.
015700
015800 230-CALCULATE-TAX-DEDUCTIONS.
015900     EVALUATE EMP-TAX-CODE
016000         WHEN 'T1'  COMPUTE WS-TAX-AMOUNT = WS-GROSS-PAY * 0.20
016100         WHEN 'T2'  COMPUTE WS-TAX-AMOUNT = WS-GROSS-PAY * 0.25
016200         WHEN 'T3'  COMPUTE WS-TAX-AMOUNT = WS-GROSS-PAY * 0.30
016300         WHEN OTHER COMPUTE WS-TAX-AMOUNT = WS-GROSS-PAY * 0.15
016400     END-EVALUATE.
016500
016600 231-CALCULATE-DEDUCTIONS.
016700     COMPUTE WS-LEAVE-DEDUCTION = PT-UNPAID-LEAVE * 
016800                                  (EMP-BASE-SALARY / 20).
016900     COMPUTE WS-TOTAL-DEDUCTIONS = WS-LEAVE-DEDUCTION + WS-TAX-AMOUNT.
017000
017100 240-GENERATE-PAYSLIP.
017200     COMPUTE WS-NET-PAY = WS-GROSS-PAY - WS-TOTAL-DEDUCTIONS.
017300     MOVE EMP-ID TO PS-EMP-ID.
017400     MOVE EMP-NAME TO PS-EMP-NAME.
017500     MOVE PT-PERIOD-START TO PS-PERIOD(1:8).
017600     MOVE '-' TO PS-PERIOD(9:1).
017700     MOVE PT-PERIOD-END TO PS-PERIOD(10:8).
017800     MOVE WS-GROSS-PAY TO PS-GROSS-PAY.
017900     MOVE WS-TAX-AMOUNT TO PS-TAX-DEDUCTIONS.
018000     MOVE WS-LEAVE-DEDUCTION TO PS-OTHER-DEDUCTIONS.
018100     MOVE WS-NET-PAY TO PS-NET-PAY.
018200     MOVE WS-CURRENT-YEAR TO PS-PAYMENT-DATE(1:4).
018300     MOVE '-' TO PS-PAYMENT-DATE(5:1).
018400     MOVE WS-CURRENT-MONTH TO PS-PAYMENT-DATE(6:2).
018500     MOVE '-' TO PS-PAYMENT-DATE(8:1).
018600     MOVE WS-CURRENT-DAY TO PS-PAYMENT-DATE(9:2).
018700     WRITE PAYSLIP-RECORD.
018800
018900 300-TERMINATE-PAYROLL.
019000     CLOSE EMPLOYEE-FILE
019100           PAYROLL-TRANS-FILE
019200           PAYSLIP-FILE.
019300